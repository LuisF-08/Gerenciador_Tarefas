{% extends 'base.html' %}

{% block conteudo %}

<!-- CSS PARA O EFEITO DE DESFOQUE -->
<style>
    .modal-backdrop.show {
        backdrop-filter: blur(5px); /* Desfoca o fundo */
        opacity: 0.8;               /* Deixa o fundo um pouco mais escuro */
    }
</style>

<div class="row mb-4">
    <div class="col-12 text-end">
        <!-- BOTÃO QUE ABRE O MODAL -->
        <button type="button" class="btn btn-success btn-lg shadow" data-bs-toggle="modal" data-bs-target="#modalCriarTarefa">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-plus-lg me-1" viewBox="0 0 16 16">
                <path fill-rule="evenodd" d="M8 2a.5.5 0 0 1 .5.5v5h5a.5.5 0 0 1 0 1h-5v5a.5.5 0 0 1-1 0v-5h-5a.5.5 0 0 1 0-1h5v-5A.5.5 0 0 1 8 2"/>
            </svg>
            Nova Tarefa
        </button>
    </div>
</div>

<!-- AQUI VAI SUA LISTA DE TAREFAS (Cards ou Tabela) -->
<div class="row">
    <!-- ... seu loop for das tarefas ... -->
</div>


<!-- === O MODAL (JANELA QUE ABRE POR CIMA) === -->
<div class="modal fade" id="modalCriarTarefa" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-0 shadow-lg">
      
      <!-- Cabeçalho do Modal -->
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title fw-bold">Nova Tarefa</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <!-- Formulário -->
      <form action="{% url 'adicionar_task' %}" method="POST">
          {% csrf_token %}
          <div class="modal-body p-4">
            
            <div class="mb-3">
                <label for="titulo" class="form-label fw-bold">Título</label>
                <input type="text" class="form-control form-control-lg" id="titulo" name="titulo" placeholder="Ex: Comprar café" required>
            </div>

            <div class="mb-3">
                <label for="descricao" class="form-label">Descrição</label>
                <textarea class="form-control" id="descricao" name="descricao" rows="3" placeholder="Detalhes da tarefa..."></textarea>
            </div>

            <div class="mb-3">
                <label for="estado" class="form-label">Status Inicial</label>
                <select class="form-select" name="estado" id="estado">
                    <option value="pendente" selected>Pendente</option>
                    <option value="concluido">Concluído</option>
                    <option value="erro">Com Erro</option>
                </select>
            </div>

          </div>
          <div class="modal-footer bg-light">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
            <button type="submit" class="btn btn-primary px-4">Salvar Tarefa</button>
          </div>
      </form>
    </div>
  </div>
</div>

{% endblock %}

<!-- Não coloque tags </body>, </html> ou <script> aqui. O base.html já cuida disso. 
    Use esta parte de baixo no body-->
<!-- ... Resto do seu base.html ... -->

    <!-- CONTAINER DE NOTIFICAÇÕES (TOASTS) -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3">
        {% if messages %}
            {% for message in messages %}
            <div id="liveToast" class="toast align-items-center text-bg-success border-0 show" role="alert" aria-live="assertive" aria-atomic="true">
                <div class="d-flex">
                    <div class="toast-body fs-6">
                        <i class="bi bi-check-circle-fill me-2"></i> {{ message }}
                    </div>
                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
            </div>
            {% endfor %}
        {% endif %}
    </div>

    <!-- SCRIPT PARA FAZER O TOAST SUMIR SOZINHO -->
    <script>
        // Aguarda o site carregar
        document.addEventListener("DOMContentLoaded", function() {
            // Pega todos os elementos com a classe .toast
            var toastElList = [].slice.call(document.querySelectorAll('.toast'))
            var toastList = toastElList.map(function (toastEl) {
                // Inicia o Toast do Bootstrap com delay de 5 segundos (5000ms)
                return new bootstrap.Toast(toastEl, { delay: 5000 });
            });
            
            // Mostra os toasts
            toastList.forEach(toast => toast.show());
        });
    </script>

    <!-- Seu script do Bootstrap Bundle já deve estar aqui -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>